<html>
   <head>
      <title>Highcharts Tutorial</title>
      <script src = "https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src = "https://code.highcharts.com/highcharts.js"></script>
	  <script src="https://code.highcharts.com/modules/exporting.js"></script>
	  <script src="https://code.highcharts.com/modules/export-data.js"></script>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.6.1/p5.js"></script>
	  <script>
		
	  </script>
   </head>
   
   <body>
<select id="hidefilter">
  <option value="show">Show All</option>
  <option value="hide">Hide All</option>
</select>
<select id="weekfilter">
<option value="todas">Todas as semanas</option>
</select>
      <div id = "container" style = "width: 1286px; height: 720px; margin: 0 auto"></div>
	  <p></p>
      
      <script language = "JavaScript">
         $(document).ready(function() {
		 
		 
//var text = '{"title":"K.F.G.M","xAxis":{"categories":[20,21]},"yAxis":{"title":"Doações"},"series":[{"data":[1284,533],"name":"Tipsicoroyale"},{"data":[1154,519],"name":"Vitão"},{"data":[400,93],"name":"GENERAL NATHAN"},{"data":[801,554],"name":"Ubira"},{"data":[165,null],"name":"John Piratel"},{"data":[106,142],"name":"DenisGAMER"},{"data":[150,83],"name":"Vilão BR"},{"data":[149,null],"name":"Caio Eduardo"},{"data":[170,477],"name":"João Oliveira"},{"data":[8,0],"name":"tiagoejf"},{"data":[0,null],"name":"filipe"},{"data":[1025,447],"name":"Jujuba"},{"data":[80,106],"name":"♣dhiego♣"},{"data":[0,0],"name":"zepequeno"},{"data":[462,352],"name":"NEYLIELTON XD"},{"data":[24,159],"name":"wisk25"},{"data":[163,105],"name":"EuSouUmBobo"},{"data":[104,null],"name":"Anonymus"},{"data":[0,98],"name":"Te matei"},{"data":[0,0],"name":"Kamikaze"},{"data":[183,146],"name":"ph"},{"data":[799,581],"name":"Cassião"},{"data":[674,438],"name":"fukushima"},{"data":[0,0],"name":"RUSSO"},{"data":[336,241],"name":"Nane"},{"data":[343,271],"name":"TioSama"},{"data":[0,0],"name":"Daniel guitar"},{"data":[154,null],"name":"Lendário!"},{"data":[0,0],"name":"xXEyEXx"},{"data":[0,0],"name":"Deadpool"},{"data":[198,190],"name":"ViTuRaNu"},{"data":[217,166],"name":"gelli-clash"},{"data":[178,96],"name":"arthur"},{"data":[341,272],"name":"spartacus"},{"data":[751,490],"name":"ALANREIS"},{"data":[0,0],"name":"tartaruga ninja"},{"data":[180,49],"name":"gui super"},{"data":[0,0],"name":"RHUANGAMES"},{"data":[0,0],"name":"Hawk eSports"},{"data":[0,0],"name":"carlio"},{"data":[84,60],"name":"nova 1 rafa"},{"data":[76,48],"name":"IMORTAL"},{"data":[0,0],"name":"Lord Archreis"},{"data":[153,21],"name":"IKADUATCPV"},{"data":[582,445],"name":"rodrigo"},{"data":[16,0],"name":"Srta Mandii"},{"data":[0,0],"name":"Rampaage2020"},{"data":[null,138],"name":"Arthur o Grande"}]}';

//		var json = JSON.parse(text);
		var json = {};
		var jsonweek = {};
		var jsonmain = {};
		$.ajax({url: "https://doc-14-18-docs.googleusercontent.com/docs/securesc/ha0ro937gcuc7l7deffksulhg5h7mbp1/4kthos3q7qi4na1576eg7dahagl1u4c0/1527278400000/08429605326402585515/*/197Ur6frl4vwV32i6-ivswOS94llBVRyJ?e=download", success: function(result){
            json = JSON.parse(JSON.stringify(result));
			
        
		var chart = {
               type: 'spline'
            };
              var subtitle = {
               text: 'Clan: '+json.title
            };
		var yAxis = {title: {
               text: 'Doações'
            }};
		var title = {
               text: 'Gráfico de '+yAxis.title.text
            };

            var tooltip = {
               valueSuffix: ''
            };
            var legend = {
               layout: 'vertical',
               align: 'right',
               verticalAlign: 'middle',
               borderWidth: 0
            };
		var plotOptions = {
               spline: {
                  dataLabels: {
                     enabled: false
                  },   
                  enableMouseTracking: true
               }
            };

            
            json.chart = chart;
            json.title = title;
	    json.subtitle = subtitle;
	    json.yAxis = yAxis;
            json.tooltip = tooltip;
            json.legend = legend;
            json.plotOptions = plotOptions;
          
		
		json.xAxis.categories.forEach(function(item){
			$('#weekfilter').append('<option value="'+item+'">Semana '+item+'</option>');
		});
		jsonweek = JSON.parse(JSON.stringify(json));
		jsonmain = JSON.parse(JSON.stringify(json));
		plotChart(jsonmain,'main');
		}});//fim do ajax
		function plotChart(dataplot,t) {
			if(t=='main'){
			dataplot.series.forEach(function(serie,index){
				if(serie.data[serie.data.length-1] == null){
				dataplot.series.splice(index,1);
			}
			});
			Highcharts.chart('container',dataplot);
			} else {
			Highcharts.chart('container',dataplot);
			}
			
		}
			//$('#container').highcharts(json);
			
			var valweek;
			var firstweek = 20;
		$("#weekfilter").change(function() {
		valweek = $(this).val();
			if (valweek == "todas") {
				//$('#container').highcharts(json);
				plotChart(jsonmain,'main');
			} else {
				var seriepie = [];
				var serieweek = {};
				var data = [];

				jsonweek.chart.type = 'pie';
				jsonweek.subtitle.text = json.subtitle.text+" Semana: "+valweek;
				json.series.forEach(function(serie,index){
					data.push(serie);
					delete data.data;
					data[index].name = json.series[index].name;
					data[index].y = json.series[index].data[valweek-firstweek];
					
				});
				data.forEach(function(serie,index){
					if(serie.y == undefined){
					data.splice(index,1);
					}
				});
				serieweek.name = 'Semana '+valweek;
				serieweek.colorByPoint = true;
				serieweek.data = data;
				seriepie.push(serieweek);
				jsonweek.series = seriepie;
				jsonweek.tooltip.pointFormat = '{series.name}: <b>{point.y} ({point.percentage:.1f}%)</b>';
				jsonweek.plotOptions = {
					pie: {
						allowPointSelect: true,
						cursor: 'pointer',
						dataLabels: {
							enabled: true,
							format: '<b>{point.name}</b>: {point.y} ({point.percentage:.1f} %)',
							style: {
								color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
							}
						},
						showInLegend: true
					}
				}
				//var a = JSON.stringify(jsonweek);
				//$("p").text(a);
				//$('#container').highcharts(jsonweek);
				
				plotChart(jsonweek,'week');
			}
		});
		$("#hidefilter").change(function() {
		var graph = $('#container').highcharts();
        
		if($("#weekfilter").val() == "todas"){
		var series = graph.series[0];
			if ($(this).val() == "hide") {
            $(graph.series).each(function(){
                //this.hide();
                this.setVisible(false, false);
            });
            graph.redraw();
        } else if($(this).val() == "show"){
            $(graph.series).each(function(){
                //this.show();
                this.setVisible(true, false);
            });
            graph.redraw();
        }
		} else {
		var series = graph.series[0].data;
        if ($(this).val() == "hide") {
            $(graph.series[0].data).each(function(){
                //this.hide();
                this.setVisible(false, false);
            });
            graph.redraw();
        } else if($(this).val() == "show"){
            $(graph.series[0].data).each(function(){
                //this.show();
                this.setVisible(true, false);
            });
            graph.redraw();
        }
		}
    });
         });
      </script>
      
   </body>
</html>